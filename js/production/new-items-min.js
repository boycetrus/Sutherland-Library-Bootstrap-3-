$(document).ready(function(){function e(e){$(".loading").fadeOut("fast"),document.location.href=e}function t(e,t,o,a,i){void 0!==o?$('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a target="_blank" href="'+t+'">'+e+'</a></h3></div><div class="panel-body"><p>'+o+'</p><p><a data-isbn="'+a+'" data-bib="'+i+'" data-url="'+t+'" data-title="'+e+'" href="#!">More Info</a></p></div></div>').appendTo("#newItems"):$('<div class="panel panel-default" data-isbn="'+a+'" data-bib="'+i+'"><div class="panel-heading"><h3 class="panel-title"><a target="_blank" href="'+t+'">'+e+'</a></h3></div><div class="panel-body"><p><a data-isbn="'+a+'" data-bib="'+i+'" data-url="'+t+'" data-title="'+e+'" href="#!">More Info</a></p></div></div>').appendTo("#newItems"),$("#newItems .panel-body a").addClass("fire-gbks btn btn-info")}function o(o,a,i){var s="http://webpac.sutherlandshire.nsw.gov.au/feeds/"+o+".xml",n="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss%20where%20url%3D'http%3A%2F%2Fwebpac.sutherlandshire.nsw.gov.au%2Ffeeds%2F"+o+".xml'&format=json&diagnostics=true&callback=?",r="http://feedburner.google.com/fb/a/mailverify?uri=SutherlandShireLibraries"+o+"&loc=en_US";$.getJSON(n,function(){console.log("json request:"+n),console.log("success")}).done(function(o){if(console.log("retrieved JSON data"),$(".loading").hide(),$("#newItemsData > h2").text(a),$("#emailSubscribe").attr("href",r),$("#rssSubscribe").attr("href",s),$("#newItems").empty(),1===o.query.count){var n=o.query.results.item.title,l=o.query.results.item.link,d=o.query.results.item.description,c=o.query.results.item.guid.content.split(" ",1),u=l.toString().substring(48,56),m="http://encore.sutherlandshire.nsw.gov.au/iii/encore/record/C__R"+u;t(n,m,d,c,u)}else o.query.count>1?$.each(o.query.results.item,function(e,o){var a=o.title,i=o.link,s=o.description,n=o.guid.content.split(" ",1),r=i.toString().substring(48,56),l="http://encore.sutherlandshire.nsw.gov.au/iii/encore/record/C__R"+r;t(a,l,s,n,r)}):(console.log("no data retrieved"),e(i));$(".new-items-data").fadeIn("slow")}).fail(function(){console.log("fail"),e(i)}).error(function(){console.log("error"),e(i)})}function a(e,t,o){var a="https://www.googleapis.com/books/v1/volumes?q=isbn:"+e;$.getJSON(a,function(){console.log("Google Books JSON request successful")}).done(function(a){if(a.totalItems>0){console.log(a);var i=a.items[0].volumeInfo.imageLinks,s=a.items[0].volumeInfo.description,n=a.items[0].searchInfo,r=a.items[0].accessInfo.webReaderLink,l,d;l=void 0!==i?a.items[0].volumeInfo.imageLinks.thumbnail:"img/no-cover.png",d=void 0!==s?s:void 0!==n?n.textSnippet:"Houston, we have a problem; there's no summary on Google Books",$(".modal-header h4").text(o),$(".modal-body").empty(),$('<div class="gbks-cover"><img id="coverImage" alt="cover image" /></div><div class="gbks-summary"><p id="isbn"></p><p id="summary"></p></div>').appendTo(".modal-body"),$("#coverImage").attr("src",l),$("#isbn").text("ISBN: "+e),$("#summary").text(d),$(".modal-footer .btn-success").text("Request it!").attr("href",t),$(".modal-footer .btn-default").removeAttr("disabled").attr("href",r),$("#bookDetails").modal()}else{console.log("Sorry, no information found for that book");var c="Bad news friend. It looks like we could not get any extra information about that title. Best go straight to the Library Catalogue for more.";$(".modal-header h4").text(o),$(".modal-body").empty(),$(".modal-body").html('<p id="message">'+c+"</p>"),$(".modal-footer .btn-success").text("View Catalogue").attr("href",t),$(".modal-footer .btn-default").attr("disabled","disabled"),$("#bookDetails").modal()}})}$(".loader").on("click",function(e){$(".new-items-data").hide(),$(".new-items-fail").hide(),$(".loading").fadeIn("fast");var t=$(this).data("feed"),a=$(this).text(),i=$(this).attr("href");o(t,a,i),e.preventDefault()}),$("#newItems").on("click",".fire-gbks",function(e){var t=$(this).data("isbn"),o=$(this).data("url").toString(),i=$(this).data("title");console.log(t,o,i),a(t,o,i),e.preventDefault()}),o("newadultfiction","New Fiction","!")});